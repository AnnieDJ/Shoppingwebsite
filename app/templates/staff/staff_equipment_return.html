{% extends "base.html" %} {% block title %}Daily Return List{% endblock %} {%
block content %}
<h2>Today's Rental Returns - {{ store_name }} Store</h2>
    <h3 style="font-weight: bold; padding: 10px 0;">Date: {{today}}</h3>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>Rental ID</th>
        <th>Customer Name</th>
        <th>Equipment Name</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for return in returns %}

      <tr>
        <td>{{ return.rental_id }}</td>
        <td>{{ return.first_name }} {{ return.family_name }}</td>
        <td>{{ return.equipment_name }}</td>
        <td>{{ return.start_date }}</td>
        <td>{{ return.end_date }}</td>
        <td id="status-{{ return.rental_id }}">{{ return.status }}</td>
        <td id="action-buttons-{{ return.rental_id }}">
          <button
          type="button"
          class="btn btn-primary btn-sm d-block w-100 mb-2"
          id="btn-uncheck-{{ return.rental_id }}"
          onclick="updateStatus({{ return.rental_id }}, 'Checked and Returned')">
          Checked and Returned
        </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<script>
 function updateStatus(rentalId, newStatus) {
    var form = new FormData();
    form.append('rental_id', rentalId);
    form.append('new_status', newStatus);

    fetch('{{ url_for('staff.update_return_status') }}', {
        method: 'POST',
        body: form
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            document.getElementById('status-' + rentalId).textContent = newStatus;
            var actionButtons = document.getElementById('action-buttons-' + rentalId);
            actionButtons.style.display = (newStatus === 'Completed' ? 'none' : 'block');
            alert('Status updated to ' + newStatus);
        } else {
            throw new Error(data.message || 'Unknown error occurred');
        }
    })
    .catch(error => {
        console.error('Error updating status:', error);
        alert('Failed to update status: ' + error.message);
    });
}

</script>

{% endblock %}
