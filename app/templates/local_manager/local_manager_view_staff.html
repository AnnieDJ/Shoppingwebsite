{% extends "base.html" %} {% block title %}Local Manager View Staff List{%
endblock %} {% block content %}
<div
  class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
>
  <h1 class="h2">Staff List - {{ store_name }} Store</h1>
</div>

<div class="table-responsive">
  <table class="table table-striped" id="staffTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)" scope="col">
          Staff ID &#x25B2;&#x25BC;<input
            type="text"
            id="filterStaffID"
            class="form-control form-control-sm"
            placeholder="Filter"
          />
        </th>
        <th onclick="sortTable(2)" scope="col">
          Title &#x25B2;&#x25BC;<input
            type="text"
            id="filterTitle"
            class="form-control form-control-sm"
            placeholder="Filter"
          />
        </th>
        <th onclick="sortTable(3)" scope="col">
          First Name &#x25B2;&#x25BC;<input
            type="text"
            id="filterFirstName"
            class="form-control form-control-sm"
            placeholder="Filter"
          />
        </th>
        <th onclick="sortTable(4)" scope="col">
          Family Name &#x25B2;&#x25BC;<input
            type="text"
            id="filterFamilyName"
            class="form-control form-control-sm"
            placeholder="Filter"
          />
        </th>
        <th onclick="sortTable(5)" scope="col">
          Email &#x25B2;&#x25BC;<input
            type="text"
            id="filterEmail"
            class="form-control form-control-sm"
            placeholder="Filter"
          />
        </th>
        <th onclick="sortTable(5)" scope="col">
          Phone Number &#x25B2;&#x25BC;<input
            type="text"
            id="filterPhoneNumber"
            class="form-control form-control-sm"
            placeholder="Filter"
          />
        </th>
        <th onclick="sortTable(6)" scope="col">
          Status &#x25B2;&#x25BC;<input
            type="text"
            id="filterStatus"
            class="form-control form-control-sm"
            placeholder="Filter"
          />
        </th>
        <th onclick="sortTable(7)" scope="col">
          Actions &#x25B2;&#x25BC;<input
            type="text"
            id="filterActions"
            class="form-control form-control-sm"
            placeholder="Filter"
            disabled
          />
        </th>
      </tr>
    </thead>
    <tbody></tbody>
    <tbody id="staffTableBody">
      {% for member in staff %}
      <tr>
        <td>{{ member.staff_id }}</td>
        <td>{{ member.title }}</td>
        <td>{{ member.first_name }}</td>
        <td>{{ member.family_name }}</td>
        <td>{{ member.email }}</td>
        <td>{{ member.phone_number }}</td>
        <td>{{ member.status }}</td>
        <td>
          <a
            href="{{ url_for('local_manager.update_staff', staff_id=member.staff_id) }}"
            class="btn btn-sm btn-warning"
            >Update</a
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const filterInputs = document.querySelectorAll("thead input, thead select");
    const tableBody = document.getElementById("staffTableBody");
    const rows = tableBody.getElementsByTagName("tr");

    filterInputs.forEach((input) => {
      input.addEventListener("input", filterTable);
      input.addEventListener("change", filterTable);
    });

    function filterTable() {
      for (let row of rows) {
        let showRow = true;
        filterInputs.forEach((input) => {
          const column = input.parentElement.cellIndex;
          const filter = input.value.toLowerCase();
          const cell = row.getElementsByTagName("td")[column];
          const text = cell.textContent.toLowerCase();

          if (filter && text.indexOf(filter) === -1) {
            showRow = false;
          }
        });
        row.style.display = showRow ? "" : "none";
      }
    }
  });

  function sortTable(column) {
    var table,
      rows,
      switching,
      i,
      x,
      y,
      shouldSwitch,
      dir,
      switchcount = 0;
    table = document.getElementById("staffTable");
    switching = true;
    dir = "asc"; // Initial direction is ascending
    while (switching) {
      switching = false;
      rows = table.rows;
      for (i = 1; i < rows.length - 1; i++) {
        shouldSwitch = false;
        x = rows[i].getElementsByTagName("TD")[column];
        y = rows[i + 1].getElementsByTagName("TD")[column];
        if (dir == "asc") {
          if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        } else if (dir == "desc") {
          if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        }
      }
      if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        switchcount++;
      } else {
        if (switchcount == 0 && dir == "asc") {
          dir = "desc";
          switching = true;
        }
      }
    }
  }
</script>

{% endblock %}
